{% extends "layout.html.twig" %}
{% block content %}
    <div class="col-md-8 col-md-offset-2">
        <h1>Contact</h1>
        <h3>Email</h3>
        {% for contact in contacts %}
            <strong>{{ contact.name }}</strong>
            <p class="text-muted">{{ contact.title }}</p>
            <button class="btn btn-xs btn-default" onclick="showEmail(this, '{{ contact.email }}', '{{ contact.emkey }}')">Show Email</button>
            <br />
            <hr />
        {% endfor %}
    </div>
    <script>
        function showEmail(btn, email, key) {
            email = unescape(email);
            key = unescape(key);
            var dest = new Array(email.length);
            for (var i = 0; i < email.length; i++) {
                dest[i] = String.fromCharCode(email.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            email = dest.join("");
            $("<a/>").attr("href", "mailto:" + email)
                    .text(email)
                    .insertBefore(btn);
            $(btn).remove();
        }
    </script>
{% endblock %}